<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Imagens Aleatórios de Cachorros</h1>
	<p> A partir do click no botão abaixo uma nova imagem aleatória de cachorros será carregada utilizando requisições assíncronas com XMLHttpRequest</p>

	<img id="img_dog" src="" alt="Aguardando a imagem ser carregada" />
	<br/>
	<button onclick="carregarImagens()">Carregar Imagens</button>
    <script type="text/javascript">

		function carregarImagens(){

			var xmlHttpRequest = new XMLHttpRequest(); // aqui criamos a chamada
			var url = "https://dog.ceo/api/breeds/image/random"; // API de imagens de cachorros

			xmlHttpRequest.open("GET", url, true); // nessa linha o xml vai pegar o metodo GET (ou post), dentro da URL. Por ser True é assíncrona ( false é síncrona )

			xmlHttpRequest.onreadystatechange = function() { // onreadystatechange = monitora o estado da requisição
				if (xmlHttpRequest.readyState == 3) {
					console.log('Carregando o conteúdo');
					/* podemos adicionar um loading aqui, mas dependendo do site pode ser tão rápido que nem vai dar tempo de ver o loading
					Vai avisar o status do carregamento
					mas nessa parte o mais importante seria o state 4 e status 200 que diria que a pagina está completamente carregada */
				}
				if (xmlHttpRequest.readyState == 4) { // podemos utilizar também readyState == 200

					var jsonResponse = JSON.parse(xmlHttpRequest.responseText); // PARSE: é necessário quando o recurso requisitado devolve o conteúdo em formato JSON
					// depois de verificar a validação que terminou ele vai trazer e mostrar o que ele trouxe.
					// parse transforma o texto em um objeto JSON
					// stringify transforma um objeto JSON em texto

					console.log('Requisição Finalizada');
					console.log('Resultado da Requisição: ' + jsonResponse);
					console.log('Resultado da Requisição: ' + jsonResponse.message);

					var imgDog = document.getElementById("img_dog");
					imgDog.src = jsonResponse.message; // aplica o link do carrinho na imagem
				}
			};

			xmlHttpRequest.send(null); // executa o pedido. Sebdi metodo que envia a requisição. No caso do GET é null, no caso do POST teria que enviar algo

		}
	</script>
</body>
</html>